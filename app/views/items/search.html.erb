<div class="container">
  <div class="page-header" id="banner">
    <div class="row my-4">
      <div class="col-12">
        <h3>仕入対象商品の情報取得</h3>
        <div class="form-inline">
          <%= form_tag('/items/search', method:'post', id:'items_search') do %>
            <div class="form-inline">
              <div class="form-group">
                <label>検索用キーワード</label>
                <%= text_field_tag('input_key', nil,  class: 'form-control', style: 'margin-left:10px; margin-right:20px;') %>
              </div>
              <%= submit_tag '取得開始', class: 'btn btn-info' %>
            </div>
          <% end %>
        </div>
        <br>
        進行状況
        <div class="progress" style="width: 60%;">
          <div class="progress-bar progress-bar-striped active" id="progress_bar" role="progressbar" style="width: <%= ((@account.current_item_num * 100) / @account.max_item_num).round(0) %>%;">
            <%= ((@account.current_item_num * 100) / @account.max_item_num).round(0) %>%
          </div>
        </div>

        <br>
        <h5>取得済み件数　全<%= @total.to_i %>件</h5>
        <%= paginate @items %>
        <table class="table table-striped table-hover table-bordered ellipsis" id="item_table">
          <thead class="thead-light">
            <tr>
              <th style="text-align:center;">出品</th>
              <th style="text-align:center;">候補ASIN</th>
              <th style="text-align:center;">アマゾン画像</th>
              <% @headers.each do |key, value| %>
              <th style="text-align:center;"><%= value %></th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% @items.each do |temp| %>
            <tr>
              <td class="td_vertical_align_middle"></td>
              <td class="td_vertical_align_middle"><%= if @converter.find_by(original_key: temp.item.jan) != nil then @converter.find_by(original_key: temp.item.jan).product_id else nil end %></td>
              <td class="td_vertical_align_middle"></td>
              <% @headers.each do |key, value| %>
                <% case key %>
                <% when :image then %>
                <td class="td_vertical_align_middle"><%= if temp.item[key] != nil then image_tag(temp.item[key], height:'70px') end %></td>
                <% when :shop_id then %>
                <td class="td_vertical_align_middle"><%= temp.item.shop.name %></td>
                <% when :url then %>
                <td class="td_vertical_align_middle"><%= link_to temp.item[key], temp.item[key], target: '_blank' %></td>
                <% else %>
                <td class="td_vertical_align_middle"><%= temp.item[key] %></td>
                <% end %>
              <% end %>
            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function(){
    $('#download_template').on('click', function() {
      setTimeout(function(){
          location.href = '/products/show';
      },1000);
    });
  });
</script>
